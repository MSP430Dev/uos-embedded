#summary Compilation of uOS modules.

= Компиляция модулей uOS =

Система состоит из набора модулей, которые компилируются независимо, в отдельных подкаталогах. При сборке пользователь указывает в файле [compile_target target.cfg] список модулей, которые необходимы для данного конкретного проекта.

= Параметры модуля =
Параметры конкретного модуля содержатся в его каталоге в файле `module.cfg`. Необходимо определить:
 * VPATH - список каталогов с исходными текстами модуля
 * OBJS - список объектных файлов модуля

Модуль получает параметры:
 * MODULEDIR - имя каталога с текстами модуля
 * ARCH - архитектура процессора для сборки

Пример:
{{{
VPATH  = $(MODULEDIR) $(MODULEDIR)/$(ARCH)

OBJS    = halt.o itake.o irelease.o lock.o lsignal.o ltry.o\
          main.o tcreate.o tdelete.o texit.o tname.o tprio.o\
          tsetprio.o tstack.o twait.o lgroup.o machdep.o\
          tprivate.o tsetprivate.o tyield.o
}}}

Для сборки модуля вызывается утилита make, используя общий скрипт `uos/sources/module.cfg`:
{{{
include $(TARGET)/target.cfg

CONTRIB ?= $(OS)/contrib
ifeq ($(OS)/sources/$(MODULE), $(wildcard $(OS)/sources/$(MODULE)))
    MODULEDIR = $(OS)/sources/$(MODULE)
else
    MODULEDIR = $(CONTRIB)/$(MODULE)
endif
include $(MODULEDIR)/module.cfg

all:    $(TARGET)/libuos.a

$(TARGET)/libuos.a: $(OBJS)
        $(AR) $(ARFLAGS) $@ $?

clean::
        rm -rf *.[oai] *~ .deps

include $(OS)/targets/rules.cfg
}}}

Скрипту передаются параметры в переменных:
 * OS - путь к текстам uOS
 * TARGET - путь к рабочему каталогу компиляции, содержащему `target.cfg`
 * MODULE - название компилируемого модуля