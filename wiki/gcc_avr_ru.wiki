#summary Installation of GCC cross-compiler for Atmel AVR architecture

= Установка компилятора GCC для AVR =
Описана установка кросс-системы программирования для микроконтроллеров
семейства [http://atmel.com/products/avr/ Atmel AVR].
Устанавливается поддержка языков Си и Си++.
Используется компилятор версии [http://gcc.gnu.org/gcc-4.4/ GCC 4.4.1].

Готовый бинарный пакет можно скачать здесь:
 * [http://uos-embedded.googlecode.com/files/gcc433-avr.tgz gcc433-avr.tgz] -- для Linux
 * [http://uos-embedded.googlecode.com/files/gcc410-avr.zip gcc410-avr.zip] -- для Windows

== Установка под Linux или FreeBSD или Mac OS X ==

Мы будем собирать все из исходных текстов. Для этого в Вашей системе должен
быть установлен компилятор GCC. Также необходимо наличие пакета texinfo
и библиотек GMP и MPFR. В Ubuntu Linux эти компоненты можно установить
командами:
{{{
  apt-get install texinfo
  apt-get install libgmp3-dev
  apt-get install libmpfr-dev
}}}

Устанавливать готовую систему программирования будем в каталог
/usr/local/avr441 по номеру версии GCC 4.4.1. Это упростит в будущем
переход на новые версии компилятора.

Для простоты предположим, что сборка производится в каталоге /src.
Вы можете использовать любой другой каталог по Вашему выбору,
произведя соответствующие изменения в выполняемых командах.

Скачайте тексты в каталог /src:
  * [ftp://sourceware.org/pub/binutils/releases/binutils-2.19.1.tar.bz2 binutils-2.19.1.tar.bz2] (15 Мбайт)
  * [http://ftp.gnu.org/pub/gnu/gcc/gcc-4.4.1/gcc-core-4.4.1.tar.bz2 gcc-core-4.4.1.tar.bz2] (25 Мбайт)

Распакуйте их:
{{{
  cd /src
  tar xvjf binutils-2.19.1.tar.bz2
  tar xvjf gcc-core-4.4.1.tar.bz2
}}}

=== Правка для GCC ===

Рекомендуется использовать правку для AVR GCC, добавляющую возможность
располагать текстовые константы в flash-памяти:
[http://uos-embedded.googlecode.com/files/gcc43-avr-rodata.pch gcc43-avr-rodata.pch].
Чтобы применить правку, выполните команды:
{{{
  cd /src/gcc-4.4.1/gcc/config/avr
  patch < gcc43-avr-rodata.pch
}}}

У компилятора появится новый флаг -mrodata, указывающий имя секции
для текстовых констант и других глобальных инициализированных переменных
с атрибутом const. Например, чтобы поместить текстовые константы
в flash-память, вызывайте GCC так:
{{{
  gcc -mrodata=.progmem ...
}}}

=== Сборка binutils ===
Пакет binutils содержит ассемблер AS, редактор связей LD,
архиватор AR, а также набор утилит для работы с объектными файлами
(SIZE, NM, RANLIB, STRIP, и прочие).

Для успешной сборки binutils 2.19.1 следует использовать правку, исправляющую
ошибки в файле opcodes/avr-dis.c:
[http://uos-embedded.googlecode.com/files/binutils-2.19.1.pch binutils-2.19.1.pch].
Чтобы применить правку, выполните команды:
{{{
  cd /src/binutils-2.19.1/opcodes
  patch < binutils-2.19.1.pch
}}}

Сборка производится в отдельном каталоге binutils-avr. Выполните команды:
{{{
  mkdir /src/binutils-avr
  cd /src/binutils-avr
  ../binutils-2.19.1/configure --target=avr --prefix=/usr/local/avr441 --disable-nls
  make
}}}

Для установки создайте каталог. Для этого могут потребоваться полномочия суперпользователя:
{{{
  mkdir /usr/local/avr441
}}}

Установите binutils:
{{{
  cd /src/binutils-avr
  make install
}}}

=== Сборка gcc ===
Сборка компилятора производится в отдельном каталоге gcc-avr.
Выполните команды:
{{{
  mkdir /src/gcc-avr
  cd /src/gcc-avr
  ../gcc-4.4.1/configure --target=avr --prefix=/usr/local/avr441 --enable-languages=c,c++ --disable-nls --disable-shared --disable-libssp
  make
}}}

Установите gcc:
{{{
  cd /src/gcc-avr
  make install
}}}

== Установка под Windows ==

Установите CygWin. Для этого на сайте [http://cygwin.com] щёлкните
"Install Cygwin now". Это приведет к загрузке небольшого файла setup.exe,
который надо будет после загрузки запустить и выбрать набор пакетов
для установки. Достаточно выбрать пакеты bash, gcc, gmake, diffutils, libmpfr.

Дополнительно требуется скачать и установить следующие библиотеки:
  * [http://icps.u-strasbg.fr/PolyLib/polylib_src/polylib-5.22.3.tar.gz polylib-5.22.3.tar.gz]
  * [http://www.bastoul.net/cloog/pages/download/cloog-0.14.1.tar.gz]

После установки Cygwin сборка GCC производится так же, как и в Linux.