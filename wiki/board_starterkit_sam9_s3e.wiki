#summary Target board: Starterkit SAM9-S3E.

[http://www.starterkit.ru/new/index.php?name=Pages&op=page&pid=16 http://uos-embedded.googlecode.com/svn/wiki/images/sk_at91sam9xe512_s3e.jpg]

Компания Starterkit.ru предлагает отладочную плату
[http://www.starterkit.ru/new/index.php?name=Pages&op=page&pid=16 SK-AT91SAM9XE512-S3E]
с процессором [http://atmel.com/dyn/products/product_card.asp?part_id=3870 AT91SAM9260]
(в будущем [http://atmel.com/dyn/products/product_card.asp?part_id=4263 AT91SAM9XE512]).
На плате имеется:
  * 8 килобайт внутренней памяти данных	(в будущем 64 килобайта)
  * (в будущем) 256 килобайт внутренней памяти команд
  * 64 мегабайта внешней памяти данных
  * 256 мегабайт внешней памяти команд
  * 4 мегабайта внешней последовательной памяти данных
  * Порт Ethernet 100Base-T
  * Порт USB 2.0 хост (12 Мбит/сек)
  * Порт USB 2.0 устройство (12 Мбит/сек)
  * Слот для карты SD/MMC
  * Отладочный порт RS-232 (сигналы TXD, RXD)
  * Отладочный порт JTAG
  * ПЛИС Xilinx Spartan3E-500
  * 512 килобайт статической памяти, подсоединённой к ПЛИС

На плату также можно установить GSM/GPS-модем SIM508 и видеовход ADV7108.
Плата поставляется с установленной операционной системой Linux.
Протокол загрузки можно [board_sam9_boot_linux посмотреть здесь].

Документация:
  * Плата SK-AT91SAM9XE512-S3E, [http://uos-embedded.googlecode.com/svn/trunk/examples/arm-sam9-s3e/sk-at91sam9xe512-s3e.pdf схема электрическая принципиальная].
  * Микроконтроллер [http://atmel.com/dyn/resources/prod_documents/6221s.pdf SAM9260 - краткое описание].
  * Микроконтроллер [http://atmel.com/dyn/resources/prod_documents/doc6221.pdf SAM9260 - полное описание].
  * [http://atmel.com/dyn/resources/prod_documents/doc6297.pdf Getting Started with the AT91SAM9260 Microcontroller].
  * [http://atmel.com/dyn/resources/prod_documents/doc6132.pdf SAM Boot Assistant (SAM-BA) User Guide].

Программное обеспечение:
  * [http://atmel.com/dyn/resources/prod_documents/SAM9260_CDROM_image.zip AT91SAM9260 CD-ROM Image].
  * [http://atmel.com/dyn/resources/prod_documents/linux_solutions_pack_1.3.zip AT91SAM9 Linux Software Package].
  * [http://atmel.com/dyn/resources/prod_documents/softpack-1.4-at91sam9260-ek-web.zip AT91SAM9260-EK Software Package].
  * [http://atmel.com/dyn/resources/prod_documents/AT91Bootstrap1.11.zip AT91 Bootstrap], [http://atmel.com/dyn/resources/prod_documents/doc6277.pdf Application Note].
  * [http://atmel.com/dyn/resources/prod_documents/Install%20AT91-ISP%20v1.12.exe AT91-ISP.exe], [http://atmel.com/dyn/resources/prod_documents/doc6224.pdf AT91 In-System Programmer (ISP)].

Раскладка сигналов процессора и ПЛИС [board_sam9_signals описана на отдельной странице].

Расположение элементов на плате [board_sam9_connectors приведено здесь].

= Начальная загрузка =
После сброса процессор стартует с адреса 0. На этот адрес может быть назначена одна
из трёх областей памяти, в зависимости от параметров BMS и REMAP. При сбросе REMAP=0.
Подробнее смотрите таблицу 8-1 описания микроконтроллера.

|| BMS (J16)       || REMAP || Память по адресу 0x0000 0000       ||
||  1 (снят)       ||   0   || ROM - встроенный загрузчик         ||
||  0 (установлен) ||   0   || NCS0 - внешняя память (через ПЛИС) ||
||  x              ||   1   || SRAM 4k - внутренняя память        ||

Встроенный загрузчик считывает программу из внешней памяти команд, в следующей последовательности:
  * Последовательная SPI flash-память, выбираемая сигналом SPI_NPCS0 - микросхема DD2.
  * Последовательная SPI flash-память, выбираемая сигналом SPI_NPCS1 - на данной плате отсутствует.
  * Параллельная flash-память - микросхема DD6.

Если ни в одной памяти не обнаружен корректный код, запускается загрузчик SAM-BA,
позволяющий загрузить новую прошивку через порт USB или RS-232.

Встроенный загрузчик проверяет корректность кода по восьми первым 32-битным словам.
Слова 0-4 и 6-7 должны содержать команды "B" или "LDR". Слово 5 рассматривается
как длина загружаемой программы. Код помещается во внутреннюю память SRAM 4k.
Затем память переназначается на адрес 0 (REMAP=1) и управление передаётся на 0.

= Последовательность прошивки =
(TODO)
  # Снять джамперы J7 и J23 (проверьте, что джампер J16 также снят).
  # Подать питание или дать сброс кнопкой SW1.
  # Установить джампер J7 для прошивки последовательной flash-памяти DD2, или J23 для NAND flash-памяти DD6.
  # Запустить SAM-BA и прошить нужный файл.
  # Дать сброс кнопкой SW1.
